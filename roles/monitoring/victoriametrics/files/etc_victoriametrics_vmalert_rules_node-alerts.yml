groups:
  - name: node_systemd_alerts
    interval: 30s
    rules:
      - alert: SystemdServiceFailed
        expr: |
          node_systemd_unit_state{state="failed"} == 1
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Systemd service {{ $labels.name }} failed on {{ $labels.instance }}"
          description: "Service {{ $labels.name }} on node {{ $labels.instance }} is in failed state."
  - name: node_apt_alerts
    interval: 1h
    rules:
      - alert: APTUpdatesAvailable
        expr: |
          apt_upgrades_pending > 0
        for: 24h
        labels:
          severity: info
        annotations:
          summary: "APT updates pending on {{ $labels.instance }} for >24h"
          description: "Node {{ $labels.instance }} has {{ $value }} APT package updates available for more than 24 hours."
  - name: node_memory_alerts
    interval: 30s
    rules:
      - alert: LowMemoryAvailable
        expr: |
          (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100 < 10
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Low memory available on {{ $labels.instance }}"
          description: "Node {{ $labels.instance }} has only {{ $value | humanize }}% memory available (< 10% threshold)."
  - name: node_filesystem_alerts
    interval: 30s
    rules:
      - alert: LowDiskSpace
        expr: |
          (
            node_filesystem_avail_bytes{fstype!~"tmpfs|fuse.lxcfs|squashfs|vfat"}
            /
            node_filesystem_size_bytes{fstype!~"tmpfs|fuse.lxcfs|squashfs|vfat"}
          ) * 100 < 10
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Low disk space on {{ $labels.instance }}:{{ $labels.mountpoint }}"
          description: "Filesystem {{ $labels.mountpoint }} on {{ $labels.instance }} has only {{ $value | humanize }}% free space remaining (< 10% threshold)."
  - name: node_availability_alerts
    interval: 30s
    rules:
      - alert: HostDown
        expr: |
          (time() - timestamp(up{job="node"})) > 300
          and
          (time() - timestamp(up{job="node"})) < 86400
        for: 0m
        labels:
          severity: critical
        annotations:
          summary: "Host {{ $labels.instance }} stopped sending metrics"
          description: "No metrics received from {{ $labels.instance }} for more than 5 minutes."
